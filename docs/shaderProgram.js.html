<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>shaderProgram.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseTexture2D.html">BaseTexture2D</a><ul class='methods'><li data-type='method'><a href="BaseTexture2D.html#init">init</a></li><li data-type='method'><a href="BaseTexture2D.html#setActive">setActive</a></li><li data-type='method'><a href="BaseTexture2D.html#update">update</a></li></ul></li><li><a href="Camera.html">Camera</a><ul class='methods'><li data-type='method'><a href="Camera.html#addChild">addChild</a></li><li data-type='method'><a href="Camera.html#draw">draw</a></li><li data-type='method'><a href="Camera.html#NDCToWorld">NDCToWorld</a></li><li data-type='method'><a href="Camera.html#onBeforeDraw">onBeforeDraw</a></li><li data-type='method'><a href="Camera.html#screenToWorld">screenToWorld</a></li><li data-type='method'><a href="Camera.html#setActive">setActive</a></li><li data-type='method'><a href="Camera.html#setParent">setParent</a></li><li data-type='method'><a href="Camera.html#update">update</a></li><li data-type='method'><a href="Camera.html#updateMatrix">updateMatrix</a></li><li data-type='method'><a href="Camera.html#updateProjectionMatrix">updateProjectionMatrix</a></li><li data-type='method'><a href="Camera.html#updateViewProjectionMatrix">updateViewProjectionMatrix</a></li></ul></li><li><a href="DataTexture2D.html">DataTexture2D</a><ul class='methods'><li data-type='method'><a href="DataTexture2D.html#init">init</a></li><li data-type='method'><a href="DataTexture2D.html#setActive">setActive</a></li><li data-type='method'><a href="DataTexture2D.html#update">update</a></li></ul></li><li><a href="Framebuffer2D.html">Framebuffer2D</a><ul class='methods'><li data-type='method'><a href="Framebuffer2D.html#init">init</a></li><li data-type='method'><a href="Framebuffer2D.html#setActive">setActive</a></li><li data-type='method'><a href="Framebuffer2D.html#update">update</a></li></ul></li><li><a href="Mat4.html">Mat4</a><ul class='methods'><li data-type='method'><a href="Mat4.html#copy">copy</a></li><li data-type='method'><a href="Mat4.html#identity">identity</a></li><li data-type='method'><a href="Mat4.html#invert">invert</a></li><li data-type='method'><a href="Mat4.html#multiply">multiply</a></li><li data-type='method'><a href="Mat4.html#orthogonal">orthogonal</a></li><li data-type='method'><a href="Mat4.html#perspective">perspective</a></li><li data-type='method'><a href="Mat4.html#trs">trs</a></li><li data-type='method'><a href="Mat4.html#zero">zero</a></li></ul></li><li><a href="Mesh.html">Mesh</a><ul class='methods'><li data-type='method'><a href="Mesh.html#draw">draw</a></li><li data-type='method'><a href="Mesh.html#getAttribute">getAttribute</a></li></ul></li><li><a href="MeshAttribute.html">MeshAttribute</a><ul class='methods'><li data-type='method'><a href="MeshAttribute.html#bind">bind</a></li><li data-type='method'><a href="MeshAttribute.html#init">init</a></li><li data-type='method'><a href="MeshAttribute.html#setData">setData</a></li><li data-type='method'><a href="MeshAttribute.html#update">update</a></li></ul></li><li><a href="Quat.html">Quat</a><ul class='methods'><li data-type='method'><a href="Quat.html#multiply">multiply</a></li><li data-type='method'><a href="Quat.html#rotateX">rotateX</a></li><li data-type='method'><a href="Quat.html#rotateY">rotateY</a></li><li data-type='method'><a href="Quat.html#rotateZ">rotateZ</a></li><li data-type='method'><a href="Quat.html#setAxisAngle">setAxisAngle</a></li><li data-type='method'><a href="Quat.html#setEuler">setEuler</a></li></ul></li><li><a href="ShaderProgram.html">ShaderProgram</a><ul class='methods'><li data-type='method'><a href="ShaderProgram.html#compile">compile</a></li><li data-type='method'><a href="ShaderProgram.html#use">use</a></li></ul></li><li><a href="Texture2D.html">Texture2D</a><ul class='methods'><li data-type='method'><a href="Texture2D.html#init">init</a></li><li data-type='method'><a href="Texture2D.html#setActive">setActive</a></li><li data-type='method'><a href="Texture2D.html#update">update</a></li></ul></li><li><a href="Transform.html">Transform</a><ul class='methods'><li data-type='method'><a href="Transform.html#addChild">addChild</a></li><li data-type='method'><a href="Transform.html#draw">draw</a></li><li data-type='method'><a href="Transform.html#onBeforeDraw">onBeforeDraw</a></li><li data-type='method'><a href="Transform.html#setParent">setParent</a></li><li data-type='method'><a href="Transform.html#update">update</a></li><li data-type='method'><a href="Transform.html#updateMatrix">updateMatrix</a></li></ul></li><li><a href="Vec3.html">Vec3</a><ul class='methods'><li data-type='method'><a href="Vec3.html#copy">copy</a></li><li data-type='method'><a href="Vec3.html#cross">cross</a></li><li data-type='method'><a href="Vec3.html#dot">dot</a></li><li data-type='method'><a href="Vec3.html#isZero">isZero</a></li><li data-type='method'><a href="Vec3.html#length">length</a></li><li data-type='method'><a href="Vec3.html#lengthSqr">lengthSqr</a></li><li data-type='method'><a href="Vec3.html#normalize">normalize</a></li><li data-type='method'><a href="Vec3.html#transformMat4">transformMat4</a></li><li data-type='method'><a href="Vec3.html#.cross">cross</a></li><li data-type='method'><a href="Vec3.html#.dot">dot</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">shaderProgram.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @typedef {Object} Uniform
 * @description an object that contains type and value of an uniform.&lt;br>
 * @property {String} type uniform type
 * @property {*} value value of this uniform that must match the type.
 */

/** 
 * Compiles vertex shader, fragment shader and the gl program.&lt;br>
 * Applies blending modes, depth sort modes and face culling modes.&lt;br>
 * stores a set of its own uniforms as well.
 */
export class ShaderProgram{
    /** 
     * @param {String} vertexSource vertex shader glsl string
     * @param {String} fragmentSource vertex shader glsl string
     * @param {Object&lt;String, Uniform>} uniforms (optional) uniforms for this program.
     */
    constructor( vertexSource, fragmentSource, uniforms ){
        /** 
         * @description glsl source code for vertex shader 
         * @type {String}
         */
        this.vertexSource = vertexSource;
        
        /** 
         * @description glsl source code for fragment shader 
         * @type {String}
         */
        this.fragmentSource = fragmentSource;
        
        /**
         * gl shader object
         * @type {WebGLShader}
         */
        this.vertexShader = null;
        
        /**
         * gl shader object
         * @type {WebGLShader}
         */
        this.fragmentShader = null;
        
        /**
         * gl program object
         * @type {WebGLProgram}
         */
        this.program = null;
        
        /**
         * Used internally to keep track of texture units while assigning texture uniforms.
         * @type {Number}
         * @readonly
         */
        this.textureUnit = 0;
        
        /** 
         * @description uniforms for this shader program
         * @type {Object&lt;String,Uniform>}
         */
        this.uniforms = uniforms || {};
        
        /** 
         * @description cache for uniforms locations to avoid looking them up by webgl every time 
         * @type {Object&lt;String,number>}
         * @readonly
         */
        this.uniformLocations = {};
        
        /** 
         * @description cache for attribute locations to avoid looking them up by webgl every time 
         * @type {Object&lt;string,number>}
         * @readonly
         */
        this.attributeLocations = {};
        
        /**
         * Enable or disable gl.BLEND feature
         * @type {Boolean}
         * @default false
         */
        this.enableBlending = false;
        
        /**
         * gl blending source factor
         * @type {String}
         * @default 'ONE'
         */
        this.blendSRC = 'ONE';
        
        /**
         * gl blending destination factor
         * @type {String}
         * @default 'ONE'
         */
        this.blendDST = 'ONE';
        
        /**
         * Enable or disable gl.DEPTH_SORT feature
         * @type {Boolean}
         * @default true
         */
        this.enableDepth = true;
        
        /**
         * Depth sorting function
         * @type {String}
         * @default 'LEQUAL'
         */
        this.depthFunc = 'LEQUAL';
        
        /**
         * Enable or disable gl.CULL_FACE
         * @type {Boolean}
         * @default true
         */
        this.enableCulling = true;
        
        /**
         * Face culling mode
         * @type {String}
         * @default 'BACK'
         */
        this.cullFace = 'BACK';

        /**
         * used internally to check if shaders have been compiled yet
         * @type {Boolean}
         * @readonly
         */
        this.isCompiled = false;
    }
    /**
     * Creates webgl shader and program objects.&lt;br>
     * Assigns shader sources to them.&lt;br>
     * Compiles shaders, attaches them to program and links the program.&lt;br>
     * &lt;br>
     * This is called from {@link ShaderProgram#use} if {@link ShaderProgram#isCompiled} is false.
     * @param {WebGLRenderingContext} gl 
     */
    compile(gl){
        this.vertexShader = gl.createShader(gl.VERTEX_SHADER);
        this.fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(this.vertexShader, this.vertexSource);
        gl.compileShader(this.vertexShader);
        let message = gl.getShaderInfoLog(this.vertexShader);
        if (message.length > 0) {
            throw " vertex shader could not be compiled! "+message+" "+this.vertexSource;
        }
        gl.shaderSource(this.fragmentShader, this.fragmentSource);
        gl.compileShader(this.fragmentShader);
        message = gl.getShaderInfoLog(this.fragmentShader);
        if (message.length > 0) {
            throw " fragment shader could not be compiled! "+message+" "+this.fragmentSource;
        }
        this.program = gl.createProgram();
        gl.attachShader(this.program, this.vertexShader);
        gl.attachShader(this.program, this.fragmentShader);
        gl.linkProgram(this.program);
        this.isCompiled = true;
    }
    getAttributeLocation(gl, name){
        if(this.attributeLocations[name] === undefined){
            this.attributeLocations[name] = gl.getAttribLocation(this.program, name);
        }
        return this.attributeLocations[name];
    }
    getUniformLocation(gl, name){
        if(this.uniformLocations[name] === undefined){
            this.uniformLocations[name] = gl.getUniformLocation(this.program, name);
        }
        return this.uniformLocations[name];
    }
    setUniform(gl, name, type, value){
        let loc = this.getUniformLocation(gl,name);
        if(loc === null){ return; }
        switch(type){
            case 'm4': gl.uniformMatrix4fv(loc, false, value); break;
            case 'm3': gl.uniformMatrix3fv(loc, false, value); break;
            case 'm2': gl.uniformMatrix2fv(loc, false, value); break;
            case '1f': gl.uniform1f(loc, value); break;
            case '2fv': gl.uniform2fv(loc, value); break;
            case '3fv': gl.uniform3fv(loc, value); break;
            case '4fv': gl.uniform4fv(loc, value); break;
            case 't2d':
                value.setActive(gl, this.textureUnit);
                gl.uniform1i(loc, this.textureUnit);
                this.textureUnit++;
                break;
        }
    }
    /**
     * Sets this program to be active.&lt;br>
     * and sets blending mode, depth sort mode and face culling mode.
     * Also compiles the shaders if they are not compiled already.
     * @param {WebGLRenderingContext} gl 
     */
    use(gl){
        this.textureUnit = 0;
        if(!this.isCompiled){ this.compile(gl); }
        gl.useProgram(this.program);
        for(let name in this.uniforms){
            this.setUniform(gl, name, this.uniforms[name].type, this.uniforms[name].value);
        }
        if(this.enableBlending){
            gl.enable(gl.BLEND);
            gl.blendFunc( this.blendSRC, this.blendDST );
        }else{
            gl.disable(gl.BLEND);
        }
        if(this.enableDepth){ 
            gl.enable(gl.DEPTH_TEST); 
            gl.depthFunc(gl[this.depthFunc]); 
        }else{
            gl.disable(gl.DEPTH_TEST);
        }
        if(this.enableCulling){
            gl.enable(gl.CULL_FACE);
            gl.cullFace(gl[this.cullFace]);
        }else{
            gl.disable(gl.CULL_FACE);
        }
    }
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jan 14 2019 11:22:45 GMT+0200 (EET) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>


</body>
</html>
