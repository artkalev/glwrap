<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>camera.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseTexture2D.html">BaseTexture2D</a><ul class='methods'><li data-type='method'><a href="BaseTexture2D.html#init">init</a></li><li data-type='method'><a href="BaseTexture2D.html#setActive">setActive</a></li><li data-type='method'><a href="BaseTexture2D.html#update">update</a></li></ul></li><li><a href="Camera.html">Camera</a><ul class='methods'><li data-type='method'><a href="Camera.html#addChild">addChild</a></li><li data-type='method'><a href="Camera.html#draw">draw</a></li><li data-type='method'><a href="Camera.html#NDCToWorld">NDCToWorld</a></li><li data-type='method'><a href="Camera.html#onBeforeDraw">onBeforeDraw</a></li><li data-type='method'><a href="Camera.html#screenToWorld">screenToWorld</a></li><li data-type='method'><a href="Camera.html#setActive">setActive</a></li><li data-type='method'><a href="Camera.html#setParent">setParent</a></li><li data-type='method'><a href="Camera.html#update">update</a></li><li data-type='method'><a href="Camera.html#updateMatrix">updateMatrix</a></li><li data-type='method'><a href="Camera.html#updateProjectionMatrix">updateProjectionMatrix</a></li><li data-type='method'><a href="Camera.html#updateViewProjectionMatrix">updateViewProjectionMatrix</a></li></ul></li><li><a href="DataTexture2D.html">DataTexture2D</a><ul class='methods'><li data-type='method'><a href="DataTexture2D.html#init">init</a></li><li data-type='method'><a href="DataTexture2D.html#setActive">setActive</a></li><li data-type='method'><a href="DataTexture2D.html#update">update</a></li></ul></li><li><a href="Framebuffer2D.html">Framebuffer2D</a><ul class='methods'><li data-type='method'><a href="Framebuffer2D.html#init">init</a></li><li data-type='method'><a href="Framebuffer2D.html#setActive">setActive</a></li><li data-type='method'><a href="Framebuffer2D.html#update">update</a></li></ul></li><li><a href="Mat4.html">Mat4</a><ul class='methods'><li data-type='method'><a href="Mat4.html#copy">copy</a></li><li data-type='method'><a href="Mat4.html#identity">identity</a></li><li data-type='method'><a href="Mat4.html#invert">invert</a></li><li data-type='method'><a href="Mat4.html#multiply">multiply</a></li><li data-type='method'><a href="Mat4.html#orthogonal">orthogonal</a></li><li data-type='method'><a href="Mat4.html#perspective">perspective</a></li><li data-type='method'><a href="Mat4.html#trs">trs</a></li><li data-type='method'><a href="Mat4.html#zero">zero</a></li></ul></li><li><a href="Mesh.html">Mesh</a><ul class='methods'><li data-type='method'><a href="Mesh.html#draw">draw</a></li><li data-type='method'><a href="Mesh.html#getAttribute">getAttribute</a></li><li data-type='method'><a href="Mesh.html#loadOBJ">loadOBJ</a></li></ul></li><li><a href="MeshAttribute.html">MeshAttribute</a><ul class='methods'><li data-type='method'><a href="MeshAttribute.html#bind">bind</a></li><li data-type='method'><a href="MeshAttribute.html#init">init</a></li><li data-type='method'><a href="MeshAttribute.html#setData">setData</a></li><li data-type='method'><a href="MeshAttribute.html#update">update</a></li></ul></li><li><a href="Quat.html">Quat</a><ul class='methods'><li data-type='method'><a href="Quat.html#multiply">multiply</a></li><li data-type='method'><a href="Quat.html#rotateX">rotateX</a></li><li data-type='method'><a href="Quat.html#rotateY">rotateY</a></li><li data-type='method'><a href="Quat.html#rotateZ">rotateZ</a></li><li data-type='method'><a href="Quat.html#setAxisAngle">setAxisAngle</a></li><li data-type='method'><a href="Quat.html#setEuler">setEuler</a></li></ul></li><li><a href="Scene.html">Scene</a><ul class='methods'><li data-type='method'><a href="Scene.html#addTransform">addTransform</a></li><li data-type='method'><a href="Scene.html#draw">draw</a></li><li data-type='method'><a href="Scene.html#update">update</a></li></ul></li><li><a href="ShaderProgram.html">ShaderProgram</a><ul class='methods'><li data-type='method'><a href="ShaderProgram.html#compile">compile</a></li><li data-type='method'><a href="ShaderProgram.html#use">use</a></li></ul></li><li><a href="Texture2D.html">Texture2D</a><ul class='methods'><li data-type='method'><a href="Texture2D.html#init">init</a></li><li data-type='method'><a href="Texture2D.html#setActive">setActive</a></li><li data-type='method'><a href="Texture2D.html#update">update</a></li></ul></li><li><a href="Transform.html">Transform</a><ul class='methods'><li data-type='method'><a href="Transform.html#addChild">addChild</a></li><li data-type='method'><a href="Transform.html#draw">draw</a></li><li data-type='method'><a href="Transform.html#onBeforeDraw">onBeforeDraw</a></li><li data-type='method'><a href="Transform.html#setParent">setParent</a></li><li data-type='method'><a href="Transform.html#update">update</a></li><li data-type='method'><a href="Transform.html#updateMatrix">updateMatrix</a></li></ul></li><li><a href="Vec3.html">Vec3</a><ul class='methods'><li data-type='method'><a href="Vec3.html#copy">copy</a></li><li data-type='method'><a href="Vec3.html#cross">cross</a></li><li data-type='method'><a href="Vec3.html#dot">dot</a></li><li data-type='method'><a href="Vec3.html#isZero">isZero</a></li><li data-type='method'><a href="Vec3.html#length">length</a></li><li data-type='method'><a href="Vec3.html#lengthSqr">lengthSqr</a></li><li data-type='method'><a href="Vec3.html#normalize">normalize</a></li><li data-type='method'><a href="Vec3.html#transformMat4">transformMat4</a></li><li data-type='method'><a href="Vec3.html#.cross">cross</a></li><li data-type='method'><a href="Vec3.html#.dot">dot</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">camera.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Transform } from './transform.js';
import { Mat4 } from './mat4.js';
import { Framebuffer2D } from './framebuffer2D.js';

/**
 * Object containing both view and projection matrix. This makes moving the view around more intuituve.
 * @extends {Transform}
 */
export class Camera extends Transform{
    constructor(){
        super();
        this.isCamera = true;
        /**
         * Render target for this camera. if null then gl context canvas is used as target.
         * @type {Framebuffer2D}
         */
        this._target = null;
        /** width is set by target or canvas size automatically @readonly */
        this._width = 100;
        /** height is set by target or canvas size automatically @readonly */
        this._height = 100;
        this.clearColor = [0,0,0,1];
        /**
         * Field of view in degrees
         */
        this._fov = 90;
        this._near = 0.1;
        this._far = 1000.0;
        this._left = -100;
        this._right = 100;
        this._top = -100;
        this._bottom = 100;
        this._perspective = true;
        this.projectionMatrix = new Mat4();
        this.viewProjectionMatrix = new Mat4();
        this.inverseViewProjectionMatrix = new Mat4();
        /**
         * If true, the projection matrix is updated the next time this camera is set active.&lt;br>
         * This is set true if any of the projection realted parameters have been changed.
         * @name Camera#projectionNeedsUpdate
         * @type {Boolean}
         * @default true
         */
        this.projectionNeedsUpdate = true;
    }
    get target(){return this._target;}
    set target(value){ this._target = value;}
    get width(){return this._width;}
    set width(value){
        if(value != this._width){
            this._width = value;
            this.projectionNeedsUpdate = true;
        }
    }
    get height(){return this._height;}
    set height(value){
        if(value != this._height){
            this._height = value;
            this.projectionNeedsUpdate = true;
        }
    }
    get fov(){ return this._fov; }
    set fov(value){ this._fov = value; this.projectionNeedsUpdate = true; }
    get near(){ return this._near; }
    set near(value){ this._near = value; this.projectionNeedsUpdate = true; }
    get left(){ return this._left; }
    set left(value){ this._left = value; this.projectionNeedsUpdate = true; }
    get right(){ return this._right; }
    set right(value){ this._right = value; this.projectionNeedsUpdate = true; }
    get top(){ return this._top; }
    set top(value){ this._top = value; this.projectionNeedsUpdate = true; }
    get bottom(){ return this._bottom; }
    set bottom(value){ this._bottom = value; this.projectionNeedsUpdate = true; }
    get perspective(){ return this._perspective; }
    set perspective(value){ this._perspective = value; this.projectionNeedsUpdate = true; }
    
    /**
     * Updates the viewProjection combined matrix. this is done when camera transformation matrix is updated and if the projection matrix is updated.
     */
    updateViewProjectionMatrix(){
        this.viewProjectionMatrix.copy(this.worldToLocal);
        this.viewProjectionMatrix.multiply(this.projectionMatrix);
        this.inverseViewProjectionMatrix.copy(this.viewProjectionMatrix);
        this.inverseViewProjectionMatrix.invert();
    }

    /**
     * Updates the projection matrix. This is done automatically if {@link Camera#projectionNeedsUpdate} is true when {@link Camera#setActive} is called.
     */
    updateProjectionMatrix(){
        if(this.perspective){
            this.projectionMatrix.perspective( this.fov * 0.0174532925, this.width/this.height, this.near, this.far );
        }else{
            this.projectionMatrix.orthogonal( this.left, this.right, this.bottom, this.top, this.near, this.far);
        }
        this.updateViewProjectionMatrix();
        this.projectionNeedsUpdate = false;
    }

    updateMatrix(){
        super.updateMatrix();
        this.updateViewProjectionMatrix();
    }

    /**
     * Call this before drawing to set up the gl viewport and update projection matrix if needed.
     * @param {WebGLRenderingContext} gl 
     */
    setActive(gl){
        if(this._target == null){
            this.width = gl.canvas.width;
            this.height = gl.canvas.height;
        }else{
            this.width = this.target.width;
            this.height = this.target.height;
            this._target.setActive(gl);
        }
        if(this.projectionNeedsUpdate){
            this.updateProjectionMatrix();
        }
        gl.clearColor( ...this.clearColor );
        gl.viewport(0,0,this.width, this.height);
        gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT );
    }

    /**
     * Transforms the vector from NDC to world space.
     * @param {Vec3} point Screen point in NDC(normalized device coordinates).
     */
    NDCToWorld(point){
        point.transformMat4( this.localToWorld );
    }

    /**
     * Transforms the vector from screen pixel coordinates to world space.
     * @param {Vec3} point Screen point in pixel coordinates.
     */
    screenToWorld(point){
        // point to NDC
        // z is unchanged
        point.data[0] /= this._width;
        point.data[0] = point.data[0] * 2 - 1;
        
        point.data[1] /= this._height;
        point.data[1] = point.data[1] * 2 - 1;
        point.data[1]*= -1;

        // apply aspect ratio
        point.data[0] *= this._width / this._height;

        this.NDCToWorld(point);
    }
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 15 2019 09:38:45 GMT+0200 (EET) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>


</body>
</html>
